<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../img/logos/logo 1.jpeg" type="image/x-icon">
    <title>Editar Productos</title>
    <link rel="stylesheet" href="../log/admin.css">
    <style>
        /* Estilo para el contenedor de resultados de autocompletado */
        #autocomplete-results {
            position: absolute;
            border: 1px solid #ced4da;
            background-color: #ffffff;
            z-index: 1000;
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
        }

        #autocomplete-results div {
            padding: 8px;
            cursor: pointer;
        }

        #autocomplete-results div:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>
<header>
    <a href="index.html" class="logo">
        <img src="../img/logos/logo_1-removebg-sin fondo.png" alt="Logo" class="img-fluid">
    </a>
    <nav>
        <a href="../index.html">Inicio</a>
        <a href="../PRODUCTO/productos.html">Productos</a>
    </nav>
</header>

<main>
    <div class="container">
        <div class="admin-section">
            <h2>Administrar Productos</h2>
            <form id="product-form" class="product-form" action="../conexion.php" method="POST" enctype="multipart/form-data">
                <ul class="form-list">
                    <li style="position: relative;">
                        <label for="product-name">Nombre del Producto:</label>
                        <input type="text" id="product-name" name="product-name" placeholder="Nombre del producto" required>
                        <!-- Contenedor para los resultados de autocompletado -->
                        <div id="autocomplete-results"></div>
                        <!-- Campos ocultos para almacenar idarticulo y codarticulo -->
                        <input type="hidden" id="product-id" name="product-id">
                        <input type="hidden" id="product-code" name="product-code">
                    </li>
                    <li>
                        <label for="product-description">Descripción:</label>
                        <textarea id="product-description" name="product-description" rows="4" placeholder="Descripción del producto"></textarea>
                    </li>
                    <li>
                        <label for="product-price">Precio:</label>
                        <input type="number" id="product-price" name="product-price" placeholder="Precio del producto" step="0.01" required>
                    </li>
                    <li>
                        <label for="product-image">Imagen:</label>
                        <input type="file" id="product-image" name="product-image" accept="image/*">
                    </li>
                    <li>
                        <label for="show-on-homepage">Mostrar en Inicio:</label>
                        <input type="checkbox" id="show-on-homepage" name="show-on-homepage">
                    </li>
                    <div id="group-box" style="display:none; background-color: #f8f9fa; border: 1px solid #ced4da; border-radius: 5px; padding: 15px; margin-top: 15px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);">
                        <h3 style="font-size: 18px; margin-bottom: 10px;">Opciones para mostrar en inicio</h3>
                        <label for="inicioOptions" style="display: block; margin-bottom: 5px;">Seleccione una opción:</label>
                        <select id="inicioOptions" name="inicioOptions" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px; font-size: 16px;">
                            <option value="1">Productos Nuevos</option>
                            <option value="2">Productos Destacados</option>
                            <option value="3">Productos más queridos</option>
                        </select>
                    </div>
                </ul>
                <button type="submit">Guardar Producto</button>
            </form>
        </div>
    </div>
</main>

<script>
    // Manejar la visibilidad del GroupBox
    document.getElementById('show-on-homepage').addEventListener('change', function() {
        const groupBox = document.getElementById('group-box');
        groupBox.style.display = this.checked ? 'block' : 'none';
    });

    // Manejar el autocompletado para el nombre del producto
    document.getElementById('product-name').addEventListener('input', function() {
        const query = this.value;
        const resultsContainer = document.getElementById('autocomplete-results');
        const inputRect = this.getBoundingClientRect();

        if (query.length > 2) {
            fetch(`../php/search.php?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    resultsContainer.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(product => {
                            const resultItem = document.createElement('div');
                            resultItem.textContent = product.articulo;
                            resultItem.addEventListener('click', function() {
                                document.getElementById('product-name').value = product.articulo;
                                document.getElementById('product-id').value = product.id;
                                document.getElementById('product-code').value = product.codarticulo;
                                resultsContainer.style.display = 'none';
                            });
                            resultsContainer.appendChild(resultItem);
                        });

                        // Ajustar la posición del panel de autocompletado
                        resultsContainer.style.display = 'block';
                        resultsContainer.style.top = `${inputRect.bottom + window.scrollY}px`;
                        resultsContainer.style.left = `${inputRect.left + window.scrollX}px`;
                        resultsContainer.style.width = `${inputRect.width}px`;
                    } else {
                        resultsContainer.style.display = 'none';
                    }
                })
                .catch(error => console.error('Error:', error));
        } else {
            resultsContainer.style.display = 'none';
        }
    });

    // Manejar el envío del formulario
    document.getElementById('product-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Evitar el envío por defecto del formulario

        const formData = new FormData(this); // Captura los datos del formulario

        fetch('../conexion.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Producto guardado exitosamente.'); // Mostrar mensaje de éxito
            } else {
                alert('Error al guardar el producto.'); // Mostrar mensaje de error
                console.error('Error al guardar el producto:', data.message); // Mostrar mensaje en la consola
            }
        })
        .catch(error => {
            alert('Error al guardar el producto.'); // Mostrar mensaje de error
            console.error('Error:', error); // Mostrar error en la consola
        });
    });
</script>

<footer class="text-center py-4">
    <p>&copy; 2024 azumy Fantasia</p>
    <div class="social-icons">
        <a href="https://www.instagram.com/azumyfantasia" target="_blank">
            <img src="https://img.icons8.com/ios-filled/50/000000/instagram-new.png" alt="Instagram">
        </a>
        <a href="https://www.facebook.com/share/xdnLnDHCXizQeDwT/?mibextid=qi2Omg" target="_blank">
            <img src="https://img.icons8.com/ios-filled/50/000000/facebook-new.png" alt="Facebook">
        </a>
        <a href="https://wa.me/tu_numero" target="_blank">
            <img src="https://img.icons8.com/ios-filled/50/000000/whatsapp.png" alt="WhatsApp">
        </a>
        <a href="https://www.tiktok.com/@azumyfantasia?_t=8on0ihPhIer&_r=1" target="_blank">
            <img src="https://img.icons8.com/ios-filled/50/000000/tiktok.png" alt="TikTok">
        </a>
    </div>
</footer>
</body>
</html>
